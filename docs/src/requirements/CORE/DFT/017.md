---
_version: '1'
uuid: a3f8c9d1-2e4a-4b6c-9f8e-1d3a5c7b9e2f
created: 2025-01-25T00:00:00Z
parents: []
tags:
- P2
---
# CORE-DFT-017 Suspect links silently skip orphaned graph nodes

## Observation
The `Tree::suspect_links()` method silently skips graph nodes that exist in the dependency graph but have no registered HRID, without logging or reporting the issue.

## Evidence / Reproduction
1) Create a repository with a requirement that references a missing parent UUID in its frontmatter.
2) The missing parent UUID becomes a graph node (via `DiGraphMap::add_edge()` in `Tree::insert()`) but never gets an HRID registered.
3) When `suspect_links()` runs (lines 754-757 in tree.rs), it encounters these orphaned nodes:
   ```rust
   let Some(child_hrid) = self.hrids.get(&child_uuid) else {
       // Skip nodes that failed to register an HRID instead of panicking.
       continue;
   };
   ```
4) The orphaned node is silently skipped with no warning, log, or report to the user.

## Impact
- Users are unaware that their repository contains orphaned graph nodes
- Debugging graph integrity issues is difficult without visibility into these problems
- The `validate` command doesn't detect or report orphaned nodes
- Silent failures hide data quality issues

## Expected
Orphaned graph nodes should be:
1. **Logged as warnings** when encountered during `suspect_links()` traversal (minimal fix)
2. **Reported by `validate` command** as a structural integrity issue
3. **Optionally fixable** via a cleanup command that removes orphaned nodes

## Context
This escape hatch was added to prevent panics (related to CLI-DFT-014), but it went too far in the opposite direction by completely hiding the issue. A middle ground would log the problem while continuing gracefully.

## Suggested Fix
Add warning-level logging in the escape hatch:
```rust
let Some(child_hrid) = self.hrids.get(&child_uuid) else {
    tracing::warn!(
        uuid = %child_uuid,
        "Skipping orphaned graph node with no registered HRID (parent reference exists but requirement failed to load)"
    );
    continue;
};
```

A more comprehensive fix would add orphaned node detection to the `validate` command (see CLI-DFT-001 for broader validation gaps).

## GitHub Issue
https://github.com/danieleades/requiem/issues/94
