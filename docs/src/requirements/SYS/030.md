---
_version: '1'
uuid: 47212541-c5be-49c6-ba6a-50c874abf128
created: 2025-11-20T12:10:02.219594696Z
---
# SYS-030 Sync Command Enhancement

## Statement

The tool shall enhance the existing sync command (currently 'clean') with a --what flag to control what is synchronized.

## Scope

The sync command has two subcommands: **check** (default) and **fix**.

### Check subcommand (default)

Reports drift without making changes. Lists all mismatched files with their current and expected locations, and provides instructions on how to fix.

- `req sync` or `req sync check` - Check for all drift (parents + paths)
- `req sync check --what parents` - Check only parent HRID drift
- `req sync check --what paths` - Check only path drift
- Exit code 2 if drift found, 0 if clean
- Output similar to old `diagnose` command: lists each issue with remediation guidance

### Fix subcommand

Applies corrections to fix drift.

- `req sync fix` - Fix all drift with confirmation prompt
- `req sync fix --yes` - Fix without confirmation (suppresses prompt)
- `req sync fix --dry-run` - Preview changes without applying
- `req sync fix --what <TYPE>` - Fix only specific type of drift
- `--yes` and `--dry-run` are mutually exclusive (error if both provided)

### Common flags

- `--what <all|parents|paths>` - What to check/fix (default: all)
- `--quiet` - Suppress output

## Verification

**Check subcommand:**
- `req sync` (default) checks for both parent HRID and path drift, exits with code 2 if found
- `req sync check` explicitly requests check mode (same as default)
- `req sync check --what parents` checks only parent HRID drift
- `req sync check --what paths` checks only path drift
- Check output lists all issues with current/expected locations and fix instructions

**Fix subcommand:**
- `req sync fix` prompts for confirmation before applying fixes
- `req sync fix --yes` applies fixes without confirmation
- `req sync fix --dry-run` previews changes without applying
- `req sync fix --what parents` fixes only parent HRID drift
- `req sync fix --what paths` moves only files to canonical locations
- `req sync fix --yes --dry-run` returns error (mutually exclusive flags)

**General:**
- `--quiet` suppresses output except errors
- Path synchronization creates missing directories
- Command renamed from 'clean' to 'sync'
