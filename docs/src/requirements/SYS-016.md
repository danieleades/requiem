---
_version: '1'
uuid: 3f8b9d42-7e1c-4a93-9f6d-2e4a5b8c1d3f
created: 2025-10-26T00:00:00Z
tags:
- configuration
- directory-structure
- namespaces
---
# Directory Structure Modes

## Statement

The tool shall support two directory structure modes controlled by the `subfolders_are_namespaces` configuration option: filename-based mode (default) where the full HRID is encoded in the filename and folders are purely organizational, and path-based mode where subfolders encode the namespace and the filename contains only KIND-ID.

## Rationale

Different projects have different organizational needs:

1. **Filename-based mode** provides maximum flexibility - files can be organized in arbitrary folder structures without affecting their HRIDs, making it ideal for teams that reorganize frequently or use folders for non-semantic purposes (e.g., organizing by team, feature, or priority).

2. **Path-based mode** creates a tighter coupling between folder structure and namespaces, resulting in cleaner filenames and enforced consistency between directory hierarchy and requirement organization, ideal for projects with stable hierarchical component structures.

Supporting both modes allows teams to choose the approach that best fits their workflow while maintaining backward compatibility.

## Implementation Notes

### Filename-Based Mode (Default)

- Configuration: `subfolders_are_namespaces = false` or omitted
- HRID fully encoded in filename: `system-auth-REQ-001.md`
- Directory structure is purely organizational
- Files can be moved without changing HRIDs
- Example:
  ```
  requirements/
  ├── team-a/system-auth-REQ-001.md  → HRID: system-auth-REQ-001
  └── team-b/payment-USR-002.md      → HRID: payment-USR-002
  ```

### Path-Based Mode

- Configuration: `subfolders_are_namespaces = true`
- Namespace derived from folder path
- Filename contains KIND-ID only
- Automatic format inference:
  - Numeric filename (`001.md`) → KIND from parent directory
  - KIND-ID filename (`REQ-001.md`) → KIND and ID from filename
- Example:
  ```
  requirements/
  ├── system/auth/
  │   ├── REQ-001.md              → HRID: system-auth-REQ-001
  │   └── USR/002.md              → HRID: system-auth-USR-002
  └── payment/USR-003.md          → HRID: payment-USR-003
  ```

### Format Inference

In path-based mode, the tool automatically infers the file format:

1. If filename is purely numeric (e.g., `003.md`):
   - KIND is taken from immediate parent directory name
   - Namespace is taken from all ancestor directories (excluding KIND folder)
   - Example: `system/auth/USR/003.md` → HRID: `system-auth-USR-003`

2. If filename matches KIND-ID pattern (e.g., `REQ-001.md`):
   - KIND and ID parsed from filename
   - Namespace is taken from all parent directories
   - Example: `system/auth/REQ-001.md` → HRID: `system-auth-REQ-001`

### Path Parser Module

- New `src/storage/path_parser.rs` module
- `parse_hrid_from_path()`: Extracts HRID from file path based on mode
- `construct_path_from_hrid()`: Constructs file path from HRID based on mode
- Intelligent format inference for path-based mode
- Clear error messages for malformed paths

### Backward Compatibility

- Default mode is filename-based (current behavior)
- Existing projects continue to work without configuration changes
- Opt-in to path-based mode via explicit configuration

## Verification

### Filename-Based Mode

- Files with full HRID in filename are loaded correctly
- Files in subdirectories use filename for HRID, not path
- Moving files between folders doesn't change HRID
- Example: `any/path/system-REQ-001.md` always has HRID `system-REQ-001`

### Path-Based Mode

- Files with KIND-ID filename derive namespace from path
- Files with numeric-only filename use parent as KIND
- Namespace correctly constructed from multiple path segments
- Example: `a/b/c/REQ-001.md` has HRID `a-b-c-REQ-001`
- Example: `a/b/USR/001.md` has HRID `a-b-USR-001`

### Format Inference

- Numeric filenames (e.g., `001.md`) correctly identify KIND from parent
- KIND-ID filenames (e.g., `REQ-001.md`) correctly parse KIND from filename
- Invalid formats generate clear error messages
- Mixed format support (some files numeric, some KIND-ID) in same directory

### Saving Requirements

- In filename-based mode, files saved as `root/FULL-HRID.md`
- In path-based mode, files saved as `root/namespace/folders/KIND-ID.md`
- Parent directories automatically created when needed
- Existing tests continue to pass with default configuration

### Configuration

- `subfolders_are_namespaces` field added to Config struct
- Default value is `false` (filename-based)
- Serializes/deserializes correctly in config.toml
- Configuration properly passed through Directory loading

### Error Handling

- Invalid paths generate clear error messages
- Malformed filenames in path-based mode are caught
- Missing KIND in path-based mode with numeric filename is detected
